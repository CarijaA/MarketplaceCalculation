<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora de Marketplace</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            display: flex;
            justify-content: center;
        }

        .destaque {
            background-color: #f4f4f4;
            font-size: 18px;
            font-weight: bold;
            padding: 10px;
            border-radius: 5px;
            color: #007bff;
        }

        .container {
            display: flex;
            max-width: 800px;
            width: 100%;
            gap: 20px;
        }

        .inputs, .results {
            flex: 1;
            border: 1px solid #ddd;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .inputs h2, .results h2 {
            margin-bottom: 20px;
        }

        .inputs label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        .inputs input, .inputs select {
            width: calc(100% - 20px);
            padding: 8px;
            margin-bottom: 15px;
        }

        .results p {
            margin: 10px 0;
        }

        button {
            padding: 10px 20px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        button:hover {
            background-color: #0056b3;
        }

        small {
            color: gray;
            display: block;
            margin-top: -10px;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
<div class="container">
    <div class="inputs">
        <h2>Dados do Produto</h2>
        <label>Marketplace Nome:</label>
        <input type="text" id="marketplaceNome" value="MercadoLivre" disabled>

        <label>Reputação:</label>
        <input type="text" id="reputacao" placeholder="Informe a reputação">

        <label>Tipo de Envio:</label>
        <input type="text" id="tipoEnvio" placeholder="Informe o tipo de envio">

        <label>Região:</label>
        <input type="text" id="regiao" placeholder="Informe a região">

        <label>Custo do Produto:</label>
        <input type="text" id="custoProduto" placeholder="Custo do Produto" oninput="formatarMoeda(this); verificarValorPositivo(this)">

        <label>Preço de Venda:</label>
        <input type="text" id="precoVenda" placeholder="Preço de Venda" oninput="formatarMoeda(this); verificarValorPositivo(this)">

        <label>Promoção de Venda (%):</label>
        <input type="number" id="promocaoVenda" placeholder="Promoção de Venda (%)" oninput="verificarValorPositivo(this)">

        <label>Preço de Venda Líquido:</label>
        <input type="text" id="precoLiquido" placeholder="Preço de Venda Líquido" disabled>

        <label>Taxa Fixa:</label>
        <input type="number" id="taxaFixa" placeholder="Taxa Fixa" readonly>

        <label>Taxa Marketplace (%):</label>
        <input type="number" id="marketplaceTaxa" placeholder="Taxa Marketplace (%)" oninput="formatarPorcentagem(this); verificarValorPositivo(this)">

        <label>Taxa Nota Fiscal (%):</label>
        <input type="number" id="notaFiscalTaxa" placeholder="Taxa Nota Fiscal (%)" oninput="formatarPorcentagem(this); verificarValorPositivo(this)">

        <label>Peso do Produto (kg):</label>
        <input type="number" id="pesoProduto" placeholder="Peso do Produto (kg)" oninput="verificarValorPositivo(this)">

        <button id="calcular">Calcular</button>
    </div>

    <div class="results" id="resultado">
        <h2>Resultados</h2>
        <p>Os resultados aparecerão aqui.</p>
    </div>
</div>


<script>
document.getElementById('calcular').addEventListener('click', async () => {
const marketplaceNome = document.getElementById('marketplaceNome').value;
const reputacao = parseInt(document.getElementById('reputacao').value.trim()); // Agora envia um número
const tipoEnvio = parseInt(document.getElementById('tipoEnvio').value.trim()); // Agora envia um número
const regiao = parseInt(document.getElementById('regiao').value.trim()); // Agora envia um número
const custoProduto = parseFloat(document.getElementById('custoProduto').value.replace('R$ ', '').replace(',', '.'));
const precoVenda = parseFloat(document.getElementById('precoVenda').value.replace('R$ ', '').replace(',', '.'));
const promocaoVenda = parseFloat(document.getElementById('promocaoVenda').value);
const marketplaceTaxa = parseFloat(document.getElementById('marketplaceTaxa').value);
const notaFiscalTaxa = parseFloat(document.getElementById('notaFiscalTaxa').value);
const pesoProduto = parseFloat(document.getElementById('pesoProduto').value);

if (isNaN(reputacao) || isNaN(tipoEnvio) || isNaN(regiao) || isNaN(custoProduto) || isNaN(precoVenda) ||
isNaN(promocaoVenda) || isNaN(marketplaceTaxa) || isNaN(notaFiscalTaxa) || isNaN(pesoProduto)) {
document.getElementById('resultado').innerHTML = `<p style="color: red;">Preencha todos os campos corretamente.</p>`;
return;
}

const payload = {
marketplaceNome,
reputacao,
tipoEnvio,
regiao,
custoProduto,
precoVenda,
promocaoVenda,
marketplaceTaxa,
notaFiscalTaxa,
pesoProduto
};

console.log("Enviando payload:", payload); // Debug para ver o que está sendo enviado

try {
const response = await fetch('http://localhost:8080/marketplaceCalculation', {
method: 'POST',
headers: {'Content-Type': 'application/json'},
body: JSON.stringify(payload),
});

if (!response.ok) {
throw new Error(await response.text());
}

const data = await response.json();
console.log("Recebendo resposta:", data); // Debug para verificar o que o backend está retornando

document.getElementById('resultado').innerHTML = `
<p><strong>Marketplace:</strong> ${data.marketplaceNome || "Não informado"}</p>
<p><strong>Reputação:</strong> ${data.reputacao || "Não informado"}</p>
<p><strong>Tipo de Envio:</strong> ${data.tipoEnvio || "Não informado"}</p>
<p><strong>Região:</strong> ${data.regiao || "Não informado"}</p>
<p><strong>Custo do Produto:</strong> R$ ${data.custoProduto ? data.custoProduto.toFixed(2) : "0.00"}</p>
<p><strong>Preço de Venda:</strong> R$ ${data.precoVenda ? data.precoVenda.toFixed(2) : "0.00"}</p>
<p><strong>Promoção de Venda:</strong> ${data.promocaoVenda ? data.promocaoVenda.toFixed(2) : "0.00"}%</p>
<p><strong>Taxa Marketplace:</strong> ${data.marketplaceTaxa ? data.marketplaceTaxa.toFixed(2) : "0.00"}%</p>
<p><strong>Frete:</strong> R$ ${data.valorFrete ? data.valorFrete.toFixed(2) : "0.00"}</p>
<p><strong>Sobra Total:</strong> R$ ${data.sobraTotal ? data.sobraTotal.toFixed(2) : "0.00"}</p>
`;
} catch (error) {
document.getElementById('resultado').innerHTML = `<p style="color: red;">Erro: ${error.message}</p>`;
}
});
</script>
</body>
</html>
